---
import { PLACES, listAreas } from "../../../data/places";

const url = new URL(Astro.request.url);
const q = (url.searchParams.get("q") ?? "").trim().toLowerCase();
const area = (url.searchParams.get("area") ?? "").trim();

const places = PLACES.filter((p) => {
  if (area && p.area.toLowerCase() !== area.toLowerCase()) return false;
  if (!q) return true;
  const hay = [
    p.name,
    p.area,
    p.locationNote,
    p.specialisms.join(" "),
    p.sessionFormat,
    p.blurb,
  ]
    .join(" ")
    .toLowerCase();
  return hay.includes(q);
});

const areas = listAreas();
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Therapists Accepting New Clients in London</title>
    <meta name="description" content="Therapists/counsellors accepting new clients in London (verify availability and credentials)." />
    <style>
      body {
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          Helvetica, Arial;
        margin: 0;
        color: #111;
      }
      a { color: inherit; }
      .wrap { max-width: 960px; margin: 0 auto; padding: 24px; }
      .card { border: 1px solid #eee; padding: 14px; margin-bottom: 10px; }
      .muted { color:#555; }
    </style>
  </head>
  <body>
    <main class="wrap">
      <h1 style="font-size:28px; margin:0 0 8px;">Therapists Accepting New Clients (London)</h1>
      <p class="muted" style="margin:0 0 16px;">Filter by area. Verify availability and credentials directly.</p>

      <form style="display:flex; gap:12px; flex-wrap:wrap; margin-bottom:14px;">
        <input name="q" value={q} placeholder="Search" style="padding:10px; min-width:260px;" />

        <select name="area" style="padding:10px;">
          <option value="" selected={!area}>All areas</option>
          {areas.map((a) => (
            <option value={a} selected={area.toLowerCase() === a.toLowerCase()}>
              {a}
            </option>
          ))}
        </select>

        <button type="submit" style="padding:10px 14px; cursor:pointer;">Apply</button>
        <a href="/" style="margin-left:auto; text-decoration:underline;">← Home</a>
      </form>

      <ul style="list-style:none; padding:0; margin:0;">
        {places.map((p) => (
          <li class="card">
            <div style="display:flex; justify-content:space-between; gap:12px;">
              <a href={`/london/therapists/${p.slug}`}><strong>{p.name}</strong></a>
              <span class="muted">{p.area}</span>
            </div>
            <div class="muted" style="margin-top:6px;">{p.sessionFormat} • {p.specialisms.slice(0,3).join(", ")}</div>
          </li>
        ))}
      </ul>

      <p class="muted" style="margin-top:18px; font-size:14px;">
        This directory is informational and not medical advice. If you are in crisis, contact emergency services.
      </p>
    </main>
  </body>
</html>
